var KiteConnect = require('./lib').KiteConnect;

var apiKey = 'botul8yeg1hqkeei'
var apiSecret = '2e7awt1l5m0nn781rxcwfb2lgsi1jgo8'
// var apiKey = 'gvu4pixmenhmg9im'
// var apiSecret = 'qkfr1xg1gip2smdwafytppugvkhy8czj'
var requestToken = 'eSSraH8Z91r0Gnv1DF3sCz57RVD2246N'
var refreshToken = ''
var accessToken = 'MVbFcsr1yxs90uLpRHFv0jzQZIqfD7p4'

var k = new KiteConnect({
	api_key: apiKey
})

if (accessToken) {
	k.setAccessToken(accessToken)
	init()
} else {
	k.generateSession(requestToken, apiSecret).then(function (resp) {
		console.log("resp", resp)
		init()
	}).catch(function (error) {
		console.log("error", error)
		// console.log(error)
	})
}

// k.renewAccessToken(refreshToken, apiSecret).then(function (resp) {
// 	console.log("resp", resp)
// }).catch(function (error) {
// 	console.log("error", error)
// 	// console.log(error)
// })

function init() {
	console.log('init')

	k.getLTP(['NSE:INFY']).then(function (resp) {
		console.log(resp)
	}).catch(function (error) {
		console.log(error)
	})

	k.getHistoricalData(12418050, 'day', '2021-06-01', '2021-06-02', true, true).then(function (resp) {
		console.log(resp)
	}).catch(function (error) {
		console.log(error)
	})

	// k.getGTTs().then(function (resp) {
	// 	console.log(resp)
	// }).catch(function (error) {
	// 	console.log(error)
	// })

	// k.getHoldings().then(function(resp) {
	// 	console.log(resp)
	// }).catch(function (error) {
	// 	console.log(error)
	// })

	// k.getGTT(465823).then(function (resp) {
	// 	console.log(resp)
	// }).catch(function (error) {
	// 	console.log(error)
	// })

	// k.placeGTT({
	// 	trigger_type: k.GTT_TYPE_OCO,
	// 	tradingsymbol: "SBIN",
	// 	exchange: "NSE",
	// 	trigger_values: [300, 400],
	// 	last_price: 318,
	// 	orders: [{
	// 		transaction_type: k.TRANSACTION_TYPE_SELL,
	// 		quantity: 1,
	// 		product: k.PRODUCT_CNC,
	// 		order_type: k.ORDER_TYPE_LIMIT,
	// 		price: 300
	// 	}, {
	// 		transaction_type: k.TRANSACTION_TYPE_SELL,
	// 		quantity: 1,
	// 		product: k.PRODUCT_CNC,
	// 		order_type: k.ORDER_TYPE_LIMIT,
	// 		price: 400
	// 	}]
	// }).then(function (resp) {
	// 	console.log(resp)
	// }).catch(function (error) {
	// 	console.log(error)
	// })

	// k.modifyGTT(465823, {
	// 	trigger_type: k.GTT_TYPE_OCO,
	// 	tradingsymbol: "SBIN",
	// 	exchange: "NSE",
	// 	trigger_values: [301, 401],
	// 	last_price: 318,
	// 	orders: [{
	// 		transaction_type: k.TRANSACTION_TYPE_SELL,
	// 		quantity: 1,
	// 		product: k.PRODUCT_CNC,
	// 		order_type: k.ORDER_TYPE_LIMIT,
	// 		price: 300
	// 	}, {
	// 		transaction_type: k.TRANSACTION_TYPE_SELL,
	// 		quantity: 1,
	// 		product: k.PRODUCT_CNC,
	// 		order_type: k.ORDER_TYPE_LIMIT,
	// 		price: 400
	// 	}]
	// }).then(function (resp) {
	// 	console.log(resp)
	// }).catch(function (error) {
	// 	console.log(error)
	// })

	// k.deleteGTT(465823).then(function (resp) {
	// 	console.log(resp)
	// }).catch(function (error) {
	// 	console.log(error)
	// })

	// k.orderMargins([{
	// 	exchange: "NSE",
	// 	tradingsymbol: "ASHOKLEY",
	// 	transaction_type: "BUY",
	// 	variety: "regular",
	// 	product: "CNC",
	// 	order_type: "LIMIT",
	// 	quantity: 1,
	// 	price: 122.15
	// }]).then(function (resp) {
	// 	console.log(resp)
	// }).catch(function (error) {
	// 	console.log(error)
	// })
}
